<!DOCTYPE html>
<html lang="en">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      extensions: [
        "MathMenu.js",
        "MathZoom.js",
        "AssistiveMML.js",
        "a11y/accessibility-menu.js"
      ],
      jax: ["input/TeX", "output/CommonHTML"],
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      },
      TeX: {
        extensions: [
          "AMSmath.js",
          "AMSsymbols.js",
          "noErrors.js",
          "noUndefined.js",
        ]
      }
    });
    
  </script>

  \(
\newcommand{\de}[0]{\mathrm{d}}
\newcommand{\del}[0]{\partial}
\newcommand{\delz}[0]{\partial_z}
\newcommand{\delx}[0]{\partial_x}
\newcommand{\delbar}[0]{\Bar{\partial}}
\newcommand{\delbarz}[0]{\partial_{\bar{z}}}
\newcommand{\zbar}[0]}
\newcommand{\hath}[0]
\newcommand{\hatL}[0]
\newcommand{\de}[0]{\textrm{d}}
\newcommand{\Jac}[0]{\textrm{Jac}}
\newcommand{\Tot}[0]{\textrm{Tot}}
\newcommand{\sub}[0]{\subset}
\newcommand{\Tr}[0]{\textrm{Tr}}
\newcommand{\Aut}[0]{\mathrm{Aut}}
\newcommand{\End}[0]{\mathrm{End}}
\newcommand{\irr}[0]{\mathrm{irr}}
\newcommand{\Hom}[0]{\mathrm{Hom}}
\newcommand{\Sym}[0]{\mathrm{Sym}}
\newcommand{\Res}[0]{\mathrm{Res}}
\newcommand{\rank}[0]{\mathrm{rank}}
\newcommand{\reg}[0]{\mathrm{reg}}
\newcommand{\floor}[1]{\left \lfloor{#1}\right \rfloor}
\newcommand{\vectwo}[2]{\begin{pmatrix} #1 \\ #2 \end{pmatrix}}
\newcommand{\bv}[0]{\mathbf{v}}
\newcommand{\inv}[0]{^{-1}}
\newcommand{\higgs}[0]{ {\textrm{higgs }}}
\newcommand{\ts}{\textsuperscript}
\newcommand{\Mtoy}[0]{ \calM^{\textrm{toy }}}
\newcommand{\Mell}[0]{ \calM^{\textrm{ell }}}
\newcommand{\bloch}[0]{\beta}
\newcommand{\HH}[0]{\mathbb{H}}
\newcommand{\calH}[0]{\mathcal{H}}
\newcommand{\calM}[0]{\mathcal{M}}
\newcommand{\calP}[0]{\mathcal{P}}
\newcommand{\calL}[0]{\mathcal{L}}
\newcommand{\calN}[0]{\mathcal{N}}
\newcommand{\calB}[0]{\mathcal{B}}
\newcommand{\calI}[0]{\mathcal{I}}
\newcommand{\calE}[0]{\mathcal{E}}
\newcommand{\calO}[0]{\mathcal{O}}
\newcommand{\RR}[0]{\mathbb{R}}
\newcommand{\CC}[0]{\mathbb{C}}
\newcommand{\ZZ}[0]{\mathbb{Z}}
\newcommand{\PP}[0]{\mathbb{P}}
\)

  <head>
  <meta charset="UTF-8">

  <link rel="canonical" href="/toric-geometry/math-848-project/2-a-primer-on-geometric-mechanics/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="#writing^toc–section-2">

  <meta property="og:site_name" content="My digital garden">

  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">

  <link rel="stylesheet" href="/styles.css">



  
  <meta property="og:description" content="#writing^toc–section-2"/>
  

  
  <meta property="og:title" content="2 a primer on geometric mechanics">
  <meta property="og:type" content="article">
  

  
  <meta property="article:published_time" content="2022-05-14T14:07:59-04:00">
  <meta property="article:author" content="/">
  

  <meta property="og:url" content="/toric-geometry/math-848-project/2-a-primer-on-geometric-mechanics/" />

  

  <title>
    
      2 a primer on geometric mechanics &mdash; My digital garden
    
  </title>
</head>

  <body>
    <nav><div>
    <a class="internal-link" href="/"><b>My digital garden</b></a>
</div>
</nav>
    <div class="wrapper">
      <main><article>
  <div>
    <h1>2 a primer on geometric mechanics</h1>
    <time datetime="2022-05-13T16:25:54-04:00">
      Last updated on May 13, 2022
      
    </time>
  </div>

  <div id="notes-entry-container">
    <content>
      <p>#writing</p>
<pre><code class="language-toc">
</code></pre>
<p>^toc–section-2</p>

<h1 id="the-shape-of-motion-a-primer-on-geometric-mechanics">The shape of motion: A primer on geometric mechanics</h1>

<p>The Hamiltonian formulation of classical mechanics studies motion of objects, like a ball on a spring, as a flow through some phase space. Like most physics, phase space was originally implicitly assumed to be Euclidean, but the complexities of celestial mechanics outgrew this local version. Phase space was reinterpreted as a <em>manifold</em>, endowed with a “symplectic form” which controlled the dynamics. Thus, symplectic geometry was born. Eventually, symplectic geometry separated from its physical origin to become its own field of mathematics.</p>

<p>Start with the canonical example…</p>

<h2 id="the-harmonic-oscillator-and-hamiltonian-mechanics">The harmonic oscillator and Hamiltonian mechanics</h2>

<p>Physically represented by the dynamics of a spring, which applies a restoring force proportional to the displacement. The force is proportional to the acceleration, meaning the motion is described by the following differential equation:</p>

<p>\(\ddot{x} = -x\) ^eq–newtons-equations</p>

<p>Where all dimensional constants are set to one. The dynamics of this diffeq are easier to grasp in its equivlent system of first order of coupled differential equations:
\(\dot p = - x\)
\(\dot x = p\)
a physical state is a pair of position $x$ and “momentum” $p$, defining a point in “phase space” $\calP =\RR^2$ ==include image==. The equations are encoded in a vector field over phase space. Solving the system, a state evolves by rotating at a constant rate in $\RR^2$. Focusing on the position, we see the particle oscillates sinusoidally with time.</p>

<p>We can cast theses equations in the more suggestive form</p>

<p>\(\begin{gather}
	\dot p = -\frac{\del H}{\del x} \qquad \dot x = \frac{\del H}{\del p}\\
	H(x,p) = p^{2} + x^{2}
\end{gather}\)
^eq–Hamiltons</p>

<p>==say why these come from: Rotate 90 degrees==</p>

<p>The evolution of position and momentum are controlled by the derivatives of a single function on phase space, which we call the Hamiltonian.</p>

<p>The harmonic oscillator is characterized by the quadratic Hamiltonian. Their physical ubiquity stems from the mathematical role of quadratics, appearing as low order terms in Taylor series. But this Hamiltonian has a distinguished property that we’ve already seen: It generates rotation! If you start with a set of points set at different distances from zero, they will rotate at lock step, never falling out of phase. Formally, we can represent the evolution of a point of phase space $\calP$ after time $t$ by a map $\psi_t : \calP \to \calP$. The harmonic oscillator is periodic with period $T = 2\pi$, meaning everything returns after time $T$, $\psi_T = id$. This periodicity, along with the identity $\psi_t \circ \psi_s = \psi_{t+s}$, means the evolution $\psi_t$ is an $U(1)$ action on $\calP$. This is the fundamental connection between harmonic oscillators and the circle group, mentioned in the introduction. We will see many consequences of this connection below.</p>

<blockquote>
  <p>[!remark]+ 
The harmonic oscillator is uniquely characterized by this periodicity. There are many other Hamiltonians on $\RR^2$ where every point is periodic, with the same period. However, these all come from composing the harmonic oscillator Hamiltonian with an area-preserving diffeomorphisms, meaning they are harmonic oscillators in a different set of coordinates. 
^rmk–harmonic-osscilator-periodic</p>
</blockquote>

<p>We can make the $U(1)$ action explicit by identifying phase space $\RR^2$ with the complex plane $\CC$, where $x$ is the real part and $p$ is the imaginary part. Realizing $t \in U(1)$ as a unit norm element in the complex plane, the evolution $\psi_t$ is multiplication by $t$.</p>

<p>These equations naturally generalize to higher dimensions. in $n$ dimensions, there are n position variables $x_1, \dots, x_n$ with associated momenta $p_1, \dots, p_n$, defining a point in phase space  $\calP = \CC^n$. The Hamilton equations on this phase space are 
$$</p>

<p>\begin{align}
\dot p_{i}&amp;= -x_i<br />
\dot{x_{i}} &amp;= p_i
\end{align}
$$</p>

<p>The standard harmonic oscillator in $n$-dimensions is defined by a Hamiltonian 
\(H = \sum_i x_i^2 + p_i^2\)
But we notice this essentially describes $n$ different, noninteracting harmonic osscilators. Leaning into this, we split $H$ into consitituent parts: ^0da6d9</p>

\[H= \sum_i H_i ,\qquad H_i = x_i^2 + p_1^2\]

<p>Each Hamiltonian $H_i$ rotates its own factor of $\CC$ in phase space.</p>

<p>This procedure is ethos of Hamiltonian mechanics. Mechanics lives on phase space, whose structure converts a Hamiltonian function to a vector field, describing evolution under that Hamiltonian.</p>

<h2 id="symplectic-mechanics">symplectic mechanics</h2>

<p>%%==Cotangent bundle of spaces, inspired by pendulum==%%</p>

<table>
  <tbody>
    <tr>
      <td>Now we turn to geometry. We want to eventually replace the phase space $\CC^n$ with an arbitrary manifold $\calP$, and somehow define mechanics on $\calP$ that reduces to the hamiltons equations above in some coordinate chart. This is tricky with the coordinate-dependent formula [[Toric geometry/MATH848 project/2 A primer on geometric mechanics#^eq–Hamiltons</td>
      <td>2 A primer on geometric mechanics#^eq–Hamiltons]], so we need a coordinate invariant formulation. We achieve this using differential forms.</td>
    </tr>
  </tbody>
</table>

<p>This finally motivates the phase space structure of a manifold $\calP$ is encoded in a 2-form $\omega$, called the <em>Symplectic form</em>, Such that:</p>

<ul>
  <li>$\omega$ is nondegerenate, as a linear transform sending $T^*\calP$ to $T\calP$.</li>
  <li>$\de \omega = 0$.</li>
</ul>

<table>
  <tbody>
    <tr>
      <td>The first condition ensures that there always exists a unique Hamiltonian vector field $X_H$ such that $\omega(X_H,-) = \de H$. The second ensures that the sympletic form is locally modeled on the standard phase space. Closedness is necessary because the syandard symplecitc form $\CC^n$ is certainly closed, but remarkeably closeness is also sufficient. This is called [[Toric geometry/Darboux’s theorem</td>
      <td>Darboux’s theorem]]:</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>[!theorem]+ Theorem: (Darboux)
Let $(\calP,\omega)$ be a symplectic manifold. Each point $p\in \calP$, has a neighborhood $U$ with coordinate chart $\phi:U\to \CC^n$ such that $\omega$ is the pullback of the standard symplectic form on $\CC^n$. That is, $U$ has coordinates $q_i , p_i$ such that $\omega = \de q_1 \wedge \de p_1 + \dots + \de q_n \wedge \de p_n$
^thm–Darboux</p>
</blockquote>

<p>This fact makes symplectic geometry feel significantly different from other sorts of geometry. Compare this with the analagous statement in Riemannian geometry: A metric can be put in the standard, euclidean form <em>pointwise</em>, but on an open neighborhood it can diverge from the standard due to its curvature. However, Darboux’s theorem says the standard form holds on the whole open est. There are no local invariants of a symplectic form akin to curvature. Said another way, all symplectic forms are locally isomorphic. This gives symplectic geometry a fundamentally globally character, to the point that the names “symplectic geometry” and “symplectic topology” are used interchangably.</p>

<blockquote>
  <p>[!remark] Remark: Proof of Darboux’s theorem
You can find a proof of Darboux’s theorem in any book on symplectic geometry (see for instance ==Mcduff==), but to not leave you high and dry, let me give you the gist. We want to show any two symplectic forms on a small open set are equivalent by constructing a symplectomorphism: A diffeomorphisms pulling back one form to the other. (In particular, this can relate the given symplectic form to the standard one). We will instead look for an explicit path of diffeomorphisms, which is infinitesimally encoded in a time-varying vector field. A little manipulation shows this vector field satisfies a differential equation, which in fact is a version of Hamilton’s equations. By non-degeneracy, we know a solution to Hamiltons equations exists, and we are done! Though constructing a whole path of diffeomorphisms seems like it would be harder, it lets us exploit the infinitesimal geometry that we know how to manipulate. This bit of slight-of-hand is called <em>Moser’s trick</em>.  Symplectic geometry has many similar results turning structures into a standard form, all proven with a suitably generalized version of Moser’s trick. 
^rmk–mosers-trick</p>
</blockquote>

<p>Note that $\omega$ as a matrix is skew-symmetric, since it comes from a 2-from. In particular, if $n$ is odd, $\omega$ must have an unpaired zero eigenvalue, and be degenreate. So, nondegenracy means that symplectic manifolds are always even dimsnional.</p>

<blockquote>
  <p>[!Example]+ Example: Symplectic structure on $S^2$
The two dimensional sphere can be given a symplectic structure. Construct $S^2$ as the set of vectors of unit length in $\RR^3$. For a vector $p$ with unit length, the tangent space to the sphere is naturally the set of vectors normal to $p$. A symplectic form takes two tangent vectors $v,w$ and bilinearly returns a number. We define the standard symplectic form $\omega_s$ using the cross product of vectors in $\RR^3$:
\(\omega_s(v,w) = ||v \times w ||\)
This defines a two form because the cross product is bilinear and antisymmetric. As a two-form on a two dimensional manifold, it is necessarily closed. It is nondegenerate because any $v$ has a $w$ such that $v \times w \neq zero$, for instance $w = p\times v$. Hence, it is indeed symplectic.
^ex–S2-symplectic</p>
</blockquote>

<h2 id="symmetries-of-classical-mechanics">symmetries of classical mechanics</h2>
<p>A symmetry of classical mechanics is a symmetry of phase space, which is a manifold with a symplectic structure. For a general manifolds, symmetries are <em>Diffeomorphisms</em>, differentiable bijective maps with differentiable inverses. These form a group where multiplication is composition of diffeomorphisms, which in particular has an infinitesimal structure. A path of diffeomorphisms can be described infinitesimally by a differentiable vector field, which points in the direction which points are pushed. Accordingly, pushing points along a fixed vector field $X$ defines a family of diffeomorphisms, the flow $\phi_X^t$ (This structure makes the group of diffeomorphisms an infinite dimensional <em>Lie group</em>).</p>

<p>The interesting group structure comes from the failure of commutativity, measured for diffeomorphisms $a,b$ by their commutator $a \circ b \circ a\inv \circ b\inv$. The infinitesimal structure of the group is encoded by the infinitesimal version of the commutator, called the <em>Lie bracket</em>
\([X,Y] := \frac{\de}{\de s}\frac{\de}{\de t} \phi_X^t \circ \phi_Y^s \circ \phi_X^{-t} \circ \phi_Y^{-s} |_{s,t=0}\)
This measures how one vector field changes along the flow of another. Taking the inverse of the RHS shows that the Lie bracket is antisymmetric, $[X,Y] = -[Y,X]$.The associativity of the group, encoded infinitesimally, enforces a condition on the Lie brackets called the Jacobi identity
\([ [X,Y] , Z] + [ [Y,Z] , X] + [ [Z,X] , Y]=0\)
The structure of a manifold are encoded in the Lie bracket on the space of vector fields, making this space into what’s called a <em>Lie algebra</em>.</p>

<p>Symmetries of a symplectic manifold are symmetries of a manifold that preserve the symplectic structure. These are diffeomorphisms $\phi$ such that $\phi^<em>\omega = \omega$, which are called *Symplectomorphisms</em>. Infinitesimally, these are vector fields $V$ preserving the symplectic form, $\calL_V \omega = 0$. Using Cartan’s magic formula $\calL_ V = \de \iota_V + \iota_V \de$ and the fact that $\de \omega = 0$, $V$ preserves $\omega$ when $\iota_V\omega$ is closed. Locally, these forms are equal to $\de H$ for some function $H$, which by definition makes $V$ a Hamiltonian vector field. That is, infinitesimal symmetries of a symplectic manifold are locally defined by smooth functions.</p>

<p>We can now pull back the Lie algebra structure from vector fields to their defining Hamiltonian functions. This is called the <em>Poisson bracket</em>, denoted by ${H,H’}$. Just as the Lie bracket measures the change in one vector field under the flow of another, the Poisson bracket measures the change in one Hamiltonian under the flow of the other
\(\{H,H'\} \equiv \frac{\de}{\de t}\phi_{X_{H}}^t H' = X_{H}(H') = \de H' (X_{H}) = \omega(X_{H},X_{H'})\)
Note that the Poisson bracket is bilinear, by the linearity of the hamiltonian vector field. The antisymmetry of $\omega$ means the Poisson bracket is antisymmetric, and a computation in coordinates verifies the Jacobi identity. So, the Poisson bracket makes the algebra of smooth functions on phase space into a Lie algebra. And indeed, the Poisson bracket on Hamiltonians is equivalent to the lie bracket on their vector fields:
\([X_{H},X_{H'}] = X_{\{H,H'\}}\)</p>

<blockquote>
  <p>[!remark]+
We can think of the fundamental structure of classical mechanics as the algebra of smooth functions $C^\infty(M)$ with Poisson bracket (‘classical observables’). This alternate point of view to symplectic geometry gives a clear philosophical correspondence with quantum mechanics. There, the fundamental structure is the algebra of operators on a Hilbert space with commutator (‘quantum observables’). To ‘quantize’ a classical system, you associate a Hilbert space to a symplectic manifold, and construct a Lie algebra homomorphism from smooth functions with Poisson bracket to operators with commutator. In practice, this procedure can be rather difficult and is almost never possible in full generality, but that’s a story for another time.</p>
</blockquote>


    </content>

    <side style="font-size: 0.9em">
      <h3 style="margin-bottom: 1em">Notes mentioning this note</h3>
      

      <div style="font-size: 0.9em">
        <p>
          There are no notes linking to this note.
        </p>
      </div>
      
    </side>
  </div>
</article>

<hr>

<p>Here are all the notes in this garden, along with their links, visualized as a graph.</p>

<style>
  .links line {
    stroke: #ccc;
    opacity: 0.5;
  }

  .nodes circle {
    cursor: pointer;
    fill: #8b88e6;
    transition: all 0.15s ease-out;
  }

  .text text {
    cursor: pointer;
    fill: #333;
    text-shadow: -1px -1px 0 #fafafabb, 1px -1px 0 #fafafabb, -1px 1px 0 #fafafabb, 1px 1px 0 #fafafabb;
  }

  .nodes [active],
  .text [active] {
    cursor: pointer;
    fill: black;
  }

  .inactive {
    opacity: 0.1;
    transition: all 0.15s ease-out;
  }

  #graph-wrapper {
    background: #fcfcfc;
    border-radius: 4px;
    height: auto;
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"
  integrity="sha512-FHsFVKQ/T1KWJDGSbrUhTJyS1ph3eRrxI228ND0EGaEp6v4a/vGwPWd3Dtd/+9cI7ccofZvl/wulICEurHN1pg=="
  crossorigin="anonymous"></script>

<div id="graph-wrapper">
  <script>
    const MINIMAL_NODE_SIZE = 8;
    const MAX_NODE_SIZE = 12;
    const ACTIVE_RADIUS_FACTOR = 1.5;
    const STROKE = 1;
    const FONT_SIZE = 16;
    const TICKS = 200;
    const FONT_BASELINE = 40;
    const MAX_LABEL_LENGTH = 50;

    const graphData = {"edges":[{"source":"891111171143210210511411511632115101101100","target":"6532110111116101329798111117116329997116115"},{"source":"891111171143210210511411511632115101101100","target":"84105103101114115"},{"source":"77111118101321211111171143298111100121321011181011141213210097121","target":"67111110115105115116101110991213210511532107101121"},{"source":"6532110111116101329798111117116329997116115","target":"77111118101321211111171143298111100121321011181011141213210097121"},{"source":"6911311710511897114105971101163210097114981111171203911532116104101111114101109","target":"6897114981111171203911532116104101111114101109"},{"source":"5032973211211410510910111432111110321031011111091011161141059932109101991049711010599115","target":"6897114981111171203911532116104101111114101109"},{"source":"5432115101109105991089711511510599971083211211411111210111411610510111532111102321091111091011101163210997112115","target":"6811710511511610111410997971163272101991071099711032116104101111114101109"},{"source":"6811710511511610111410997971163272101991071099711032116104101111114101109","target":"6911311710511897114105971101163210097114981111171203911532116104101111114101109"},{"source":"51321161041013210310111110910111611412132111102321049711410911111010599321111159910510810897116111114115","target":"6911311710511897114105971101163210097114981111171203911532116104101111114101109"},{"source":"67112110","target":"771111091011101163210997112"},{"source":"6811710511511610111410997971163272101991071099711032116104101111114101109","target":"771111091011101163210997112"},{"source":"51321161041013210310111110910111611412132111102321049711410911111010599321111159910510810897116111114115","target":"771111091011101163210997112"},{"source":"8312110911210810199116105993211410110011799116105111110","target":"771111091011101163210997112"},{"source":"67112110","target":"8312110911210810199116105993211410110011799116105111110"},{"source":"6811710511511610111410997971163272101991071099711032116104101111114101109","target":"8312110911210810199116105993211410110011799116105111110"},{"source":"51321161041013210310111110910111611412132111102321049711410911111010599321111159910510810897116111114115","target":"8312110911210810199116105993211410110011799116105111110"},{"source":"67111110115105115116101110991213210511532107101121","target":"891111171143210210511411511632115101101100"},{"source":"891111171143210210511411511632115101101100","target":"891111171143210210511411511632115101101100"},{"source":"891111171143210210511411511632115101101100","target":"236149136235133149237149152236132184236154148"}],"nodes":[{"id":"6532110111116101329798111117116329997116115","path":"/cats","label":"A note about cats"},{"id":"84105103101114115","path":"/tigers","label":"Tigers"},{"id":"67111110115105115116101110991213210511532107101121","path":"/consistency","label":"Consistency is key"},{"id":"77111118101321211111171143298111100121321011181011141213210097121","path":"/move-your-body-every-day","label":"Move your body every day"},{"id":"84101115116","path":"/test","label":"Test"},{"id":"67112110","path":"/cpn","label":"Cpn"},{"id":"6897114981111171203911532116104101111114101109","path":"/darboux-s-theorem","label":"Darboux's theorem"},{"id":"6811710511511610111410997971163272101991071099711032116104101111114101109","path":"/duistermaat-heckman-theorem","label":"Duistermaat Heckman theorem"},{"id":"6911311710511897114105971101163210097114981111171203911532116104101111114101109","path":"/equivariant-darboux-s-theorem","label":"Equivariant darboux's theorem"},{"id":"48321169798108101321111023299111110116101110116115","path":"/0-table-of-contents","label":"0 table of contents"},{"id":"493210511011611411110011799116105111110","path":"/1-introduction","label":"1 introduction"},{"id":"5032973211211410510910111432111110321031011111091011161141059932109101991049711010599115","path":"/2-a-primer-on-geometric-mechanics","label":"2 a primer on geometric mechanics"},{"id":"51321161041013210310111110910111611412132111102321049711410911111010599321111159910510810897116111114115","path":"/3-the-geometry-of-harmonic-oscillators","label":"3 the geometry of harmonic oscillators"},{"id":"5332116111114105993210997110105102111108100115","path":"/5-toric-manifolds","label":"5 toric manifolds"},{"id":"5432115101109105991089711511510599971083211211411111210111411610510111532111102321091111091011101163210997112115","path":"/6-semiclassical-properties-of-moment-maps","label":"6 semiclassical properties of moment maps"},{"id":"553210111311710511897114105971101163299111104111109111108111103121","path":"/7-equivariant-cohomology","label":"7 equivariant cohomology"},{"id":"771111091011101163210997112","path":"/moment-map","label":"Moment map"},{"id":"8312110911210810199116105993211410110011799116105111110","path":"/symplectic-reduction","label":"Symplectic reduction"},{"id":"73110116114111","path":"/intro","label":"Intro"},{"id":"891111171143210210511411511632115101101100","path":"/your-first-note","label":"Your first seed"},{"id":"236149136235133149237149152236132184236154148","path":"/%EC%95%88%EB%85%95%ED%95%98%EC%84%B8%EC%9A%94","label":"안녕하세요"}]}
    let nodesData = graphData.nodes;
    let linksData = graphData.edges;

    const nodeSize = {};

    const updateNodeSize = () => {
      nodesData.forEach((el) => {
        let weight =
          3 *
          Math.sqrt(
            linksData.filter((l) => l.source.id === el.id || l.target.id === el.id)
              .length + 1
          );
        if (weight < MINIMAL_NODE_SIZE) {
          weight = MINIMAL_NODE_SIZE;
        } else if (weight > MAX_NODE_SIZE) {
          weight = MAX_NODE_SIZE;
        }
        nodeSize[el.id] = weight;
      });
    };

    const onClick = (d) => {
      window.location = d.path
    };

    const onMouseover = function (d) {
      const relatedNodesSet = new Set();
      linksData
        .filter((n) => n.target.id == d.id || n.source.id == d.id)
        .forEach((n) => {
          relatedNodesSet.add(n.target.id);
          relatedNodesSet.add(n.source.id);
        });

      node.attr("class", (node_d) => {
        if (node_d.id !== d.id && !relatedNodesSet.has(node_d.id)) {
          return "inactive";
        }
        return "";
      });

      link.attr("class", (link_d) => {
        if (link_d.source.id !== d.id && link_d.target.id !== d.id) {
          return "inactive";
        }
        return "";
      });

      link.attr("stroke-width", (link_d) => {
        if (link_d.source.id === d.id || link_d.target.id === d.id) {
          return STROKE * 4;
        }
        return STROKE;
      });
      text.attr("class", (text_d) => {
        if (text_d.id !== d.id && !relatedNodesSet.has(text_d.id)) {
          return "inactive";
        }
        return "";
      });
    };

    const onMouseout = function (d) {
      node.attr("class", "");
      link.attr("class", "");
      text.attr("class", "");
      link.attr("stroke-width", STROKE);
    };

    const sameNodes = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const map = new Map();
      for (const node of previous) {
        map.set(node.id, node.label);
      }

      for (const node of next) {
        const found = map.get(node.id);
        if (!found || found !== node.title) {
          return false;
        }
      }

      return true;
    };

    const sameEdges = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const set = new Set();
      for (const edge of previous) {
        set.add(`${edge.source.id}-${edge.target.id}`);
      }

      for (const edge of next) {
        if (!set.has(`${edge.source.id}-${edge.target.id}`)) {
          return false;
        }
      }

      return true;
    };

    const graphWrapper = document.getElementById('graph-wrapper')
    const element = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    element.setAttribute("width", graphWrapper.getBoundingClientRect().width);
    element.setAttribute("height", window.innerHeight * 0.8);
    graphWrapper.appendChild(element);

    const reportWindowSize = () => {
      element.setAttribute("width", window.innerWidth);
      element.setAttribute("height", window.innerHeight);
    };

    window.onresize = reportWindowSize;

    const svg = d3.select("svg");
    const width = Number(svg.attr("width"));
    const height = Number(svg.attr("height"));
    let zoomLevel = 1;

    const simulation = d3
      .forceSimulation(nodesData)
      .force("forceX", d3.forceX().x(width / 2))
      .force("forceY", d3.forceY().y(height / 2))
      .force("charge", d3.forceManyBody())
      .force(
        "link",
        d3
          .forceLink(linksData)
          .id((d) => d.id)
          .distance(70)
      )
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("collision", d3.forceCollide().radius(80))
      .stop();

    const g = svg.append("g");
    let link = g.append("g").attr("class", "links").selectAll(".link");
    let node = g.append("g").attr("class", "nodes").selectAll(".node");
    let text = g.append("g").attr("class", "text").selectAll(".text");

    const resize = () => {
      if (d3.event) {
        const scale = d3.event.transform;
        zoomLevel = scale.k;
        g.attr("transform", scale);
      }

      const zoomOrKeep = (value) => (zoomLevel >= 1 ? value / zoomLevel : value);

      const font = Math.max(Math.round(zoomOrKeep(FONT_SIZE)), 1);

      text.attr("font-size", (d) => font);
      text.attr("y", (d) => d.y - zoomOrKeep(FONT_BASELINE) + 8);
      link.attr("stroke-width", zoomOrKeep(STROKE));
      node.attr("r", (d) => {
        return zoomOrKeep(nodeSize[d.id]);
      });
      svg
        .selectAll("circle")
        .filter((_d, i, nodes) => d3.select(nodes[i]).attr("active"))
        .attr("r", (d) => zoomOrKeep(ACTIVE_RADIUS_FACTOR * nodeSize[d.id]));
    };

    const ticked = () => {
      node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
      text
        .attr("x", (d) => d.x)
        .attr("y", (d) => d.y - (FONT_BASELINE - nodeSize[d.id]) / zoomLevel);
      link
        .attr("x1", (d) => d.source.x)
        .attr("y1", (d) => d.source.y)
        .attr("x2", (d) => d.target.x)
        .attr("y2", (d) => d.target.y);
    };

    const restart = () => {
      updateNodeSize();
      node = node.data(nodesData, (d) => d.id);
      node.exit().remove();
      node = node
        .enter()
        .append("circle")
        .attr("r", (d) => {
          return nodeSize[d.id];
        })
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(node);

      link = link.data(linksData, (d) => `${d.source.id}-${d.target.id}`);
      link.exit().remove();
      link = link.enter().append("line").attr("stroke-width", STROKE).merge(link);

      text = text.data(nodesData, (d) => d.label);
      text.exit().remove();
      text = text
        .enter()
        .append("text")
        .text((d) => shorten(d.label.replace(/_*/g, ""), MAX_LABEL_LENGTH))
        .attr("font-size", `${FONT_SIZE}px`)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "central")
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(text);

      node.attr("active", (d) => isCurrentPath(d.path) ? true : null);
      text.attr("active", (d) => isCurrentPath(d.path) ? true : null);

      simulation.nodes(nodesData);
      simulation.force("link").links(linksData);
      simulation.alpha(1).restart();
      simulation.stop();

      for (let i = 0; i < TICKS; i++) {
        simulation.tick();
      }

      ticked();
    };

    const zoomHandler = d3.zoom().scaleExtent([0.2, 3]).on("zoom", resize);

    zoomHandler(svg);
    restart();

    function isCurrentPath(notePath) {
      return window.location.pathname.includes(notePath)
    }

    function shorten(str, maxLen, separator = ' ') {
      if (str.length <= maxLen) return str;
      return str.substr(0, str.lastIndexOf(separator, maxLen)) + '...';
    }
  </script>
</div>

</main>
      <footer>This is the footer. Include anything you'd like here, like a link to an <a class="internal-link" href="/about">About</a> page.
</footer>
    </div>

    <!-- That file is not particularly elegant. This will need a refactor at some point. -->
<style>
  content a.internal-link {
    border-color: #8b88e6;
    background-color: #efefff;
  }

  #tooltip-wrapper {
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    height: 250px;
    font-size: 0.8em;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transition: opacity 100ms;
  }

  #tooltip-wrapper:after {
		content: "";
		position: absolute;
		z-index: 1;
		bottom: 0;
		left: 0;
		pointer-events: none;
		background-image: linear-gradient(to bottom, rgba(255,255,255, 0), rgba(255,255,255, 1) 90%);
		width: 100%;
		height: 75px;
  }
</style>

<div style="opacity: 0; display: none;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  function hideTooltip() {
    opacityTimeout = setTimeout(function() {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function() {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop

    if (event.target.host === window.location.host) {
      iframe.src = event.target.href
      iframe.onload = function() {
        tooltipContentHtml = ''
        tooltipContentHtml += '<div style="font-weight: bold;">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
        tooltipContentHtml += iframe.contentWindow.document.querySelector('content').innerHTML

        tooltipContent.innerHTML = tooltipContentHtml

        tooltipWrapper.style.display = 'block';
        setTimeout(function() {
          tooltipWrapper.style.opacity = 1;
        }, 1)
      }

      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";
      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

  document.querySelectorAll('content a').forEach(setupListeners);
</script>

  </body>
</html>
